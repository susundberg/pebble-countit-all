<!DOCTYPE html>
<html>
  <head>
  <title>Count-it-all configuration page</title>
  <link rel='stylesheet' type='text/css' href='css/slate.min.css'>
  <script src='js/slate.js'></script>
        
  <style>
   .title {
      padding: 15px 10px;
      text-transform: uppercase;
      font-family: 'PT Sans', sans-serif;
      font-size: 1.2em;
      font-weight: 500;
      color: #888888;
      text-align: center;
   }
  </style>
</head>

  <body>
<h1 class='title'>Count-it-all configuration</h1>

<div class="item-container">
  <div class="item-container-header">Button 1 action configuration </div>
  <div class="item-container-content" id="button1-radio">
    <label class="item">
      Single 
      <input type="radio" class="item-radio" name="button1-radion" value="a" checked >
    </label>
    <label class="item">
      Duration
      <input type="radio" class="item-radio" name="button1-radion" value="b">
    </label>
    <label class="item">
      Disabled
      <input type="radio" class="item-radio" name="button1-radion" value="c" >
    </label>
  </div>
  <label class="item">
    Icon to use
    <input type="text" class="item-color item-icon" id="button1-icon" value="icon-000.png">
  </label>
</div>

<div class="item-container">
  <div class="item-container-header">Button 2 action configuration </div>
  <div class="item-container-content" id="button2-radio">
    <label class="item">
      Single 
      <input type="radio" class="item-radio" name="button2-radion" value="a" checked >
    </label>
    <label class="item">
      Duration
      <input type="radio" class="item-radio" name="button2-radion" value="b">
    </label>
    <label class="item">
      Disabled
      <input type="radio" class="item-radio" name="button2-radion" value="c" >
    </label>
  </div>
  <label class="item">
    Icon to use
    <input type="text" class="item-color item-icon" id="button2-icon" value="icon-010.png">
  </label>
</div>


<div class='item-container'>
  <div class='button-container'>
     <input id='submit_button' type='button' class='item-button' value='SAVE'>
  </div>
</div>
</body>


<script>


function getConfigData() 
{
    /// Load the data from the elements to be option hash
    var options = {};
    for ( var loop_button = 1; loop_button < 3; loop_button ++ )
    {
       var prefix="button" + loop_button;
       console.log("DOING: " + prefix );
       options[ prefix + "-icon" ] = document.getElementById( prefix + "-icon" ).value;
       var tab = document.getElementById( prefix + "-radio" );
       var selected = tab.getElementsByClassName('item-radio');
       var selected_value  = null;
       for ( var i = 0; i < selected.length; i ++ )
       {
         if ( selected[i].checked == true )
         {
           selected_value = selected[i].value ;
           break;
         }
       }
       options[ prefix + "-type" ] = selected_value;
    }
    console.log("GOT:" + JSON.stringify(options) );
    return options;
}

  function getQueryParam(variable, defaultValue) {
    var query = location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split('=');
      if (pair[0] === variable) {
        return decodeURIComponent(pair[1]);
      }
    }
    return defaultValue || false;
  }
 
  var submitButton = document.getElementById('submit_button');
  submitButton.addEventListener('click', function() {
    console.log('Submit');
    // Set the return URL depending on the runtime environment
    var return_to = getQueryParam('return_to', 'pebblejs://close#');
    document.location = return_to + encodeURIComponent(JSON.stringify(getConfigData()));
  });

  (function() 
  {
  
    function apply_options( prefix, options )
    { // apply given options on given prefix
       document.getElementById( prefix + "-icon" ).value = options["icon"];
       var radio = document.getElementById( prefix + "-radio" );
       var radio_items = radio.getElementsByClassName('item-radio');
       var selected_value  = null;
       for ( var i = 0; i < radio_items.length; i ++ )
       {
          if ( radio_items[i].value == options["type"] )
          {
             radio_items[i].checked = true;
          }
          else
          {
             radio_items[i].checked = false;
          }
       }
    }
    
    // Load any previously saved configuration, if available
    for ( var loop_button = 1; loop_button < 3; loop_button ++ )
    {
       var prefix="button" + loop_button;
       console.log("LOAD: " + prefix );
       if(localStorage['config-' + prefix + "-icon"]) 
       {
          var button_options = JSON.parse( localStorage['config-' + prefix] );
          apply_options( prefix, button_options  );
       }
    }
  })();

</script>
</html>
